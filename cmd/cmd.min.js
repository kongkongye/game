window.Cmd=function(){var n,e=new Logger(LogConstant.SOURCE_CMD),o={},t=function(t,a,c,C){if(c&&Slot.selSlotByPageId(c),a&&!(a.length<=1))if(t)e.info(LogType.OPERATE,"执行服务端命令: {0}",a),i(a,C);else if(Conn.getPhase()===ConnConstant.PHASE_LOAD)n||(n=[]),n.push({cmd:a,id:c});else{e.info(LogType.OPERATE,"执行客户端命令: {0}",a);var g=Common.split(a," ",2),s=g[0],d=o[s];d?d.handle(c,g[1]):e.warn(LogType.DETAIL,"客户端命令'{0}'未找到处理器!",s)}},i=function(n,o){Conn.send(PacketConstant.CLIENT120CMD,{cmd:n},!0).then(function(t){t.data.success?(e.debug(LogType.DETAIL,"服务端命令执行成功: {0}",n),o&&Cmd.execute(!1,"page refresh")):e.debug(LogType.DETAIL,"服务端命令执行失败: {0}",n)})};return Conn.register(PacketConstant.SERVER5120CMD_CLIENT,{handle:function(n){var e=n.cmd;t(!1,e)}}),setInterval(function(){n&&(e.info(LogType.DETAIL,"开始执行所有等待的命令..."),n.forEach(function(n){t(!1,n.cmd,n.id)}),n=null)},50),{registerClientHandler:function(n,t){o[n]=t,e.info(LogType.FUNC,"注册客户端命令处理器: {0}",n)},execute:t}}();