window.Conn=function(){var n=new Logger(LogConstant.SOURCE_CONN),e={},o={},t=ConnConstant.PHASE_LOAD,r=function(n,o){e["ID"+n]=o};return r(PacketConstant.SERVER5300CONN_PHASE,{handle:function(e){var o=e.phase;o===ConnConstant.PHASE_START?t===ConnConstant.PHASE_LOAD?(t=o,n.info(LogType.DETAIL,"连接阶段更新为: {0}",t)):n.warn(LogType.DETAIL,"异常!连接阶段无法从'{0}'更新为'{1}'",t,o):n.warn(LogType.DETAIL,"异常!目标连接阶段'{0}'目标无法处理!",o)}}),setInterval(function(){var e={},t=(new Date).getTime();for(var r in o)if(o.hasOwnProperty(r)){var i=o[r];t<=i.time+ConnConstant.CALLBACK_TIMEOUT?e[r]=i:(i.promise.reject("请求超时!"),n.debug(LogType.DETAIL,"ID为'{0}'的请求超时!",r))}o=e},1e3),{getPhase:function(){return t},connect:function(){n.info(LogType.DETAIL,"开始连接..."),Ws.connect().then(function(){n.info(LogType.DETAIL,"连接成功!")},function(){n.info(LogType.DETAIL,"连接失败!")})},disconnect:function(){n.info(LogType.DETAIL,"断开连接!"),Ws.disconnect()},send:function(n,e,t){var r=null,i=0;return t&&(r=$.Deferred(),i=Common.getRandomLong(),o[i]={promise:r,time:(new Date).getTime()}),Ws.send({id:n,reqId:i,data:e}),r},register:r,onReceive:function(t){var r,i=(r="string"==typeof t?JSON.parse(t):t).id,a=r.reqId,L=r.data;if(0!==a){var T=o[a];delete o[a],T?T.promise.resolve({data:L,id:i,reqId:a}):n.debug(LogType.DETAIL,"响应超时!包ID: {0} 请求ID: {1}",i,a)}else{var s=e["ID"+i];if(!s)return void n.warn(LogType.DETAIL,"未找到ID为'{0}'的处理器",i);s.handle(L)}}}}();