var Ws=function(){var n,o=new Logger(LogConstant.SOURCE_CONN),e=function(){return n&&1===n.readyState},t=function(n){for(var o in n)if(n.hasOwnProperty(o)){var e=n[o],r=typeof e;"object"===r?t(e):"string"===r&&(n[o]=e.replace(/{/g,"\0"))}};return{isConnected:e,connect:function(){var e=$.Deferred();return n=new WebSocket(ConnConstant.URL),n.onopen=function(){e.resolve(),n.onmessage=function(n){Conn.onReceive(n.data)},n.onerror=function(n){console.log(arguments)},n.onclose=function(e){n=null;var t=$("<div class='mask'></div>");$("body").append(t);var r=$("<div class='mask-text'><button class='btn' onclick='window.location.reload()'>刷新</button></div>");$("body").append(r),Show.show("","#g连接关闭: "+e.reason),o.warn(LogType.DETAIL,e.reason)}},n.onclose=function(){n=null,e.reject()},e},disconnect:function(){n.close(),n=null},send:function(r){e()?(t(r),n.send(JSON.stringify(r))):o.warn(LogType.DETAIL,"连接已经关闭,无法发送数据!")}}}();