window.PageShow=function(){var a=/(\[\![^\]]+\])/g,n=new Logger(LogConstant.SOURCE_PAGE),t=function(a,n,t){var c=[],o=n.type;if("line"===o)c.push(e(a,n,t));else if("br"===o)c.push(r(a,n,t));else if("list"===o)c.push(i(a,n,t));else{if("import"!==o)throw'行类型"'+o+'"无法处理!';c=c.concat(s(a,n,t))}return c},e=function(a,n,t){var e=$('<div class="line"></div>'),r=n._align;return r&&("left"===r?e.css("justify-content","flex-start"):"center"===r?e.css("justify-content","center"):"right"===r&&e.css("justify-content","flex-end")),n.components.forEach(function(n){e.append(c(a,n,t))}),m(a.id,t,a.params,n._con,e),e},r=function(a,n,t){var e=$('<div class="separator"></div>');return m(a.id,t,a.params,n._con,e),e},i=function(a,n,e){for(var r=$("<div></div>"),i=PageConfig.getListSize(a.path),s=0;s<i;s++){var c=s,o=$("<div></div>");o.hide(),r.append(o),n.lines.forEach(function(n){t(a,n,s).forEach(function(a){o.append(a)})}),function(n,t){ParamHandler.addListListener(a.id,function(a){n<a?t.show():t.hide()})}(c,o)}return m(a.id,e,a.params,n._con,r),r},s=function(a,n,e){var r=[];return PageConfig.getLines(n._path).forEach(function(n){r=r.concat(t(a,n,e))}),r},c=function(a,n,t){var e,r=n.type;if("text"===r)e=u(a,n,t);else if("button"===r)e=f(a,n,t);else if("input"===r)e=p(a,n,t);else{if("container"!==r)throw"组件类型"+r+"无法处理!";e=o(a,n,t)}var i=n._style;i&&e.addClass(i);var s=n._width;return s&&(s=parseInt(s),e.css("flex-grow",s),e.css("flex-basis",s+"%")),e},o=function(a,n,t){var e=$('<div class="component"></div>'),r=n._align;return r&&("left"===r?e.css("justify-content","flex-start"):"center"===r?e.css("justify-content","center"):"right"===r?e.css("justify-content","flex-end"):"space-between"===r?e.css("justify-content","space-between"):"space-around"===r&&e.css("justify-content","space-around")),n.components.forEach(function(n){e.append(c(a,n,t))}),e},u=function(a,n,t){var e=$('<span class="text"></span>'),r=n._align;r&&e.css("text-align",r);var i=n.content;if(i){var s=a.id,c=function(){var a=Param.replaceParams(s,i,t);e.empty(),l(a).forEach(function(a){e.append(a)})};Param.getParams(i).forEach(function(n){a.params.push({type:n.type,name:n.name,handler:c})}),c()}return m(a.id,t,a.params,n._con,e),e},f=function(a,t,e){var r=a.id,i=$('<button class="btn"></button>'),s=t.content;if(s){var c=function(){var a=Param.replaceParams(r,s,e);i.empty(),l(a).forEach(function(a){i.append(a)})};Param.getParams(s).forEach(function(n){a.params.push({type:n.type,name:n.name,handler:c})}),c()}var o,u=t._mode,f=t._cmd.substr(0,1);"/"===f?o=!0:"$"===f?o=!1:n.warn(LogType.DETAIL,"命令'{0}'没有提示符,无法识别是服务端或客户端命令!",t._cmd);var p=t._cmd.substr(1);return i.on("click",function(){for(var a=Param.getParams(p),n=0;n<a.length;n++)if(null===Param.getValue(r,a[n].type,a[n].name,e))return void Show.show("","#g缺少变量!");var t=Param.replaceParams(r,p,e);Cmd.execute(o,t,r,"refresh"===u)}),m(a.id,e,a.params,t._con,i),i},p=function(a,n,t){var e=n._multi,r=e?$('<textarea class="input input-area"></textarea>'):$('<input class="input"/>');if(!e){var i=n._type;i&&r.attr("type",i)}var s=n._description;if(s){var c=a.id,o=function(){var a=Param.replaceParams(c,s,t);r.attr("title",a),r.attr("placeholder",a)};Param.getParams(s).forEach(function(n){a.params.push({type:n.type,name:n.name,handler:o})}),o()}var u=n["_fix-width"];u&&r.css("width",u+"rem");var f=Param.getValue(a.id,ParamConstant.TYPE_INPUT,n._name,t);return null===f&&n._default&&(f=Param.replaceParams(a.id,n._default,t)),null!==f&&(Param.setInputParam(a.id,n._name,f),r.val(f)),r.on("blur",function(){Param.setInputParam(a.id,n._name,$(r).val())}),r.on("keyup",function(){Param.setInputParam(a.id,n._name,$(r).val())}),m(a.id,t,a.params,n._con,r),r},m=function(a,n,t,e,r){if(e){var i=function(){var t=Param.replaceParams(a,e,n);Con.check(t)?r.css("display",""):r.css("display","none")};Param.getParams(e).forEach(function(a){t.push({type:a.type,name:a.name,handler:i})}),Con.addParams(a,e,i),i()}},l=function(n){var t=[],e=n.split(a);for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(i.length>3&&i.match(a)){var s=i.substr(2,i.length-3);d(t,s)}else v(t,i)}return t},d=function(a,n){var t=$("<img class='img' src='"+n+"'/>");a.push(t)},v=function(a,n){Color.format(n).forEach(function(n){a.push(n)})};return{getShow:function(a,n,e){var r=$("<div></div>"),i={id:a,path:n,params:[]};return e.lines.forEach(function(a){t(i,a,-1).forEach(function(a){r.append(a)})}),ParamHandler.addParams(a,i.params),r}}}();