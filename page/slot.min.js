window.Slot=function(){var a,e=new Logger(LogConstant.SOURCE_SLOT),o={},t={},n=function(a){return t[a]},r=function(){if(a){var e=o[a],t=TabConfig.getRootCmd(e.path,e.pageIndex);d(TabConfig.getRootPath(e.path,e.idToIndexes[e.pageId]),null,t)}},d=function(e,t,n){if(a){var r=o[a].pageIndex;History.add(a,r,{path:e,rootCmd:n,args:t}),i(e,t,n)}},i=function(e,t,r){var d=o[a],i=d.pageId,s=n(i);Param.clearAll(i),ParamHandler.delParams(i),ParamHandler.delListListener(i),ParamHandler.delConListener(i),Param.setCmdParams(i,t),s.path=e,s.rootCmd=r,s.args=t,s.page=1,s.listTotal=0,s.defaultInit=!1,s.domInit=!1,g(d),c()},s=function(e){a!==e&&(a=e,u(e),c())},p=function(a,e,o){for(var t=null,n=null,r={},d={},i=$('<div class="tab"></div>'),s=$('<div class="tab-header"></div>'),p=$('<div class="tab-body"></div>'),m=o.pages,c=0;c<m.length;c++){var u=m[c],v=f(u.path),h=v.id;r[h]=c,d[h]=v,v.rootCmd=TabConfig.getRootCmd(e,c),t||(t=h,n=0);var P=$("<span></span>");P.text(u.name),function(e){P.on("click",function(){l(a,e)})}(h),v.header=P;var I=$("<div></div>");v.body=I,s.append(P),p.append(I),History.add(e,c,{path:u.path,rootCmd:v.rootCmd})}m.length<=1&&(s.addClass("tab-header-single"),p.addClass("tab-body-single")),i.append(s),i.append(p),a.pageId=t,a.pageIndex=n,a.idToIndexes=r,a.infos=d,a.tabDom=i,g(a)},f=function(a){var e=Common.getRandomId(6),o={id:e,path:a,page:1};return t[e]=o,o},l=function(a,o){e.debug(LogType.OPERATE,"改变页面: {0}",n(o).path),a.pageId=o,a.pageIndex=a.idToIndexes[o],g(a),c()},g=function(a){var o=n(a.pageId),t=PageConfig.req(o.path),r=o.rootCmd,d=Param.getParams(r),i=Param.getLackParams(a.pageId,d),s=Param.requestParamsForCmd(a.pageId,o.path,i);$.when(s,t).then(function(o,t){o&&Conn.onReceive({id:o.id,reqId:0,data:o.data});var d=n(a.pageId);if(d){if(r){var i={};Param.replaceParams(a.pageId,r,-1).split(" ").forEach(function(a){var e=Common.split(a,"=",2);i[e[0]]=e[1]}),Param.setCmdParams(a.pageId,i),d.args=i}if(!d.domInit){e.debug(LogType.DETAIL,"初始化页面: {0}",d.path),d.domInit=!0;var s=m(a.pageId);d.body.empty(),d.body.append(s)}v(a),Param.requestLackParams(a.pageId,!0)}})},m=function(a){var e=n(a),o=PageConfig.getPage(e.path);if(o){var t=o.page;if(!t._enable)throw"页面未启用!";return PageShow.getShow(a,e.path,t)}throw'路径为"'+path+'"的页面未找到!'},c=function(){$("#top-back").prop("disabled",!a||!History.hasBack(a,o[a].pageIndex)),$("#top-main").prop("disabled",!a),$("#top-refresh").prop("disabled",!a),$("#top-close").prop("disabled",!a||!o[a].canClose)},u=function(a){for(var e in o)if(o.hasOwnProperty(e)){var t=o[e];e===a?t.slotDom.addClass("slot-active"):t.slotDom.removeClass("slot-active")}},v=function(a){for(var e in a.infos)if(a.infos.hasOwnProperty(e)){var o=n(e);e===a.pageId?(o.header.addClass("active"),o.body.show()):(o.header.removeClass("active"),o.body.hide())}};return $(document).ready(function(){c()}),{addSlot:function(e,t,n,r,d){if(!o[e]){var i=$('<div class="slot panel"></div>'),f=$("<div></div>");i.append(f),Panel.addSlot(n,i);var l={path:e,canClose:d,slotDom:i,slotBodyDom:f};o[e]=l,i.css("order",r),i.on("click",function(){s(e)}),p(l,e,t),f.append(l.tabDom),a||s(e),c()}},selSlot:s,selSlotByPageId:function(a){if(a)for(var e in o)if(o.hasOwnProperty(e))for(var t in o[e].infos)if(t===a)return void s(e)},join:d,main:r,refresh:function(t){if(a)if(e.info(LogType.OPERATE,"刷新"),t){var r=n(o[a].pageId);i(r.path,r.args,r.rootCmd)}else Param.requestLackParams(o[a].pageId,!0)},back:function(){if(a){var t=o[a],n=t.idToIndexes[t.pageId],d=History.pop(a,n);d?(i(d.path,d.args,d.rootCmd),e.debug(LogType.OPERATE,"格子'{0}'返回上一页!",a)):(r(),e.debug(LogType.OPERATE,"格子'{0}'没有上一页,返回主界面!",a))}},checkInitDefault:function(a){var e=n(a);if(!e.defaultInit){e.defaultInit=!0;var o={},t=PageConfig.getPage(e.path).inputDefaults;for(var r in t)t.hasOwnProperty(r)&&(o[r]={value:Param.replaceParams(a,t[r],-1),timeout:-1});Param.setInputParams(a,o)}},getSlotInfos:function(){return o},getPages:function(){return t},getSel:function(){return a},getSlotInfo:function(a){return o[a]},getPageInfo:n,clear:function(n){if(a===n&&s(null),o[n]){var r=o[n],d=r.infos;for(var i in d)d.hasOwnProperty(i)&&delete t[i];delete o[n],r.slotDom.remove(),e.info(LogType.DETAIL,"清空tab路径'{0}'相关格子与页面信息.",n)}}}}();